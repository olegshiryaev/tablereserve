{% extends "base.html" %}
{% load static %}
{% load floattags %}
{% load custom_filters %}

{% block navbar %}
    {% include 'components/navbar.html' %}
{% endblock %}
{% block footer %}
    {% include 'components/footer.html' %}
{% endblock %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<section class="section">
    <div class="container pt-5">
        <div class="place-header">
            <h1>{{ place.type }} {{ place.name }}</h1>
            <div class="place-info">
                <div class="left-info">
                    <!-- Адрес заведения -->
                    {% if place.address %}
                    <span class="place-address">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="icon">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 4.25 7 13 7 13s7-8.75 7-13c0-3.87-3.13-7-7-7zm0 10.5c-1.93 0-3.5-1.57-3.5-3.5S10.07 5.5 12 5.5 15.5 7.07 15.5 9 13.93 12.5 12 12.5z" />
                        </svg>
                        <a href="https://yandex.ru/maps/?text={{ place.address|urlencode }}" target="_blank" style="text-decoration: none; color: inherit;">{{ place.address }}</a>
                    </span>
                    {% endif %}

                    <!-- Телефон заведения -->
                    {% if place.phone %}
                    <span class="place-phone">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="icon">
                            <path d="M6.62 10.79a15.53 15.53 0 006.59 6.59l2.2-2.2a1.5 1.5 0 011.7-.27c1.2.48 2.5.74 3.84.74a1.5 1.5 0 011.5 1.5v3.75a1.5 1.5 0 01-1.5 1.5A18 18 0 012 4.5a1.5 1.5 0 011.5-1.5H7.25a1.5 1.5 0 011.5 1.5c0 1.34.26 2.63.74 3.84a1.5 1.5 0 01-.27 1.7l-2.2 2.2z" />
                        </svg>
                        <a href="tel:{{ place.phone }}" style="text-decoration: none; color: inherit;">{{ place.phone|format_phone_number }}</a>
                    </span>
                    {% endif %}
                </div>
                <div class="right-info">
                    <!-- Рейтинг и отзывы заведения -->
                    {% if reviews.count > 0 %}
                        <div class="place-rating-and-reviews">
                            <div class="review-count">
                                {{ reviews.count }} {{ review_word }}
                            </div>
                            {% if place.rating > 1 %}
                                <div class="place-rating {{ place.rating|rating_color }} address-rating">
                                    {{ place.rating|formatted_float }}
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="place-detail-container">
            <div class="place-detail-sub-title">
                <div class="place-sub-title font-semibold"></div>
            </div>
            
            <!-- Кнопка добавления в избранное -->
            <button class="favorite-button {% if is_favorited %}favorited{% endif %}" data-place-id="{{ place.id }}" aria-label="Add to favorites">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                </svg>
            </button>

            <!-- Галерея изображений -->
            <div id="gallery" class="place-detail-gallery">
                <div class="place-detail-gallery-wrapper">
                    {% if place.images.exists %}
                        {% if place.images.count == 1 %}
                            <!-- Единственное изображение занимает всю галерею -->
                            {% for media in place.images.all %}
                                {% if media.image %}
                                <div class="place-single-image">
                                    <img src="{{ media.image.url }}" alt="Image of {{ place.name }}" loading="lazy" class="place-full-image" />
                                </div>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <!-- Множественные изображения -->
                            <button class="gallery-prev-slide" aria-label="Previous slide">❮</button>
                            <div class="place-slider">
                                <div class="place-slider-wrapper">
                                    {% for media in place.images.all %}
                                        <div class="place-slider-item" style="margin-right: 5px;">
                                            {% if media.video_url %}
                                                <iframe width="560" height="315" src="{{ media.video_url }}" frameborder="0" allowfullscreen></iframe>
                                            {% elif media.embed_code %}
                                                {{ media.embed_code|safe }}
                                            {% elif media.image %}
                                                <img data-src="{{ media.image.url }}" class="place-slider-img lazy" alt="Image of {{ place.name }}" loading="lazy" />
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            <button class="gallery-next-slide">❯</button>
                        {% endif %}
                    {% else %}
                        <!-- Сообщение о том, что изображения будут добавлены позже -->
                        <div class="no-images-placeholder br-24 border">
                            <svg xmlns="http://www.w3.org/2000/svg" height="96px" viewBox="0 -960 960 960" width="96px" fill="#888" class="no-images-icon">
                                <path d="M479.5-267q72.5 0 121.5-49t49-121.5q0-72.5-49-121T479.5-607q-72.5 0-121 48.5t-48.5 121q0 72.5 48.5 121.5t121 49Zm0-60q-47.5 0-78.5-31.5t-31-79q0-47.5 31-78.5t78.5-31q47.5 0 79 31t31.5 78.5q0 47.5-31.5 79t-79 31.5ZM140-120q-24 0-42-18t-18-42v-513q0-23 18-41.5t42-18.5h147l73-87h240l73 87h147q23 0 41.5 18.5T880-693v513q0 24-18.5 42T820-120H140Zm0-60h680v-513H645l-73-87H388l-73 87H140v513Zm340-257Z"/>
                            </svg>
                            <p class="no-images-message" style="width:310px">Скоро здесь будет фото – интерьер уже позирует</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Модальное окно для полноэкранного изображения -->
            <div id="imageModal" class="gallery-modal">
                <span class="gallery-modal-close">&times;</span>
                <img class="gallery-modal-content" id="modalImage">
                <a class="gallery-modal-prev">❮</a>
                <a class="gallery-modal-next">❯</a>
            </div>

            <div class="place-detail-main">
                <div class="place-detail-main-container">
                    <!-- Меню по странице -->
                    <div class="page-navigation-menu">
                        <ul class="page-navigation-list">
                            <li><a href="#place-type">О {{ place_type_phrase }}</a></li>
                            <li><a href="#menu-prices">Меню и цены</a></li>
                            <li><a href="#reviews">Отзывы</a></li>
                            <li><a href="#similar-places">Похожие заведения</a></li>
                        </ul>
                    </div>
                    <div id="place-type" class="place-type-section">
                        <div class="place-detail-section">
                            <div class="place-detail-inner">
                                <div class="place-detail-item">
                                    <div class="place-detail-item-label">
                                        Кухня
                                    </div>
                                    <div class="place-detail-item-body">
                                        <div class="place-detail-item-value">
                                            {% if place.cuisines.all %}
                                                {% for cuisine in place.cuisines.all %}
                                                    {{ cuisine.name }}{% if not forloop.last %}, {% endif %}
                                                {% endfor %}
                                            {% else %}
                                                <span>-</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="place-detail-item">
                                    <div class="place-detail-item-label">
                                        Средний чек
                                    </div>
                                    <div class="place-detail-item-body">
                                        <div class="place-detail-item-value">
                                            {% if place.average_check %}
                                                {{ place.average_check }} руб.
                                            {% else %}
                                                <span>-</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="place-detail-item">
                                    <div class="place-detail-item-label">
                                        Телефон
                                    </div>
                                    <div class="place-detail-item-body">
                                        <a href="tel:{{ place.phone }}" class="place-detail-item-value">
                                            {{ place.phone|format_phone_number }}
                                        </a>
                                        <div class="place-detail-item-action">
                                            {% if place.telegram %}
                                                <a href="{{ place.telegram }}" target="_blank" class="place-detail-item-action-link">
                                                    <img src="{% static 'icons/telegram.svg' %}" alt="Telegram">
                                                </a>
                                            {% endif %}
                                            {% if place.whatsapp %}
                                                <a href="https://wa.me/{{ place.whatsapp }}" target="_blank" class="place-detail-item-action-link">
                                                    <img src="{% static 'icons/whatsapp.svg' %}" alt="WhatsApp">
                                                </a>
                                            {% endif %}
                                            {% if place.viber %}
                                                <a href="viber://chat?number={{ place.viber }}" target="_blank" class="place-detail-item-action-link">
                                                    <img src="{% static 'icons/viber.svg' %}" alt="Viber">
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                <div class="place-detail-item">
                                    <div class="place-detail-item-label">
                                        Время работы
                                    </div>
                                    <div class="place-detail-item-body">
                                        {% if today_schedule %}
                                            {% if today_schedule.is_closed %}
                                                <div class="place-detail-item-value">
                                                    сегодня закрыто
                                                </div>
                                            {% else %}
                                                <div class="place-detail-item-value">
                                                    сегодня с {{ today_schedule.open_time|time:"H:i" }} до {{ today_schedule.close_time|time:"H:i" }}
                                                </div>
                                            {% endif %}
                                        {% else %}
                                            <div class="place-detail-item-value">
                                                -
                                            </div>
                                        {% endif %}
                                        {% if schedules %}
                                            <div class="place-detail-item-action" style="position: relative;">
                                                <span class="place-detail-item-action-link work-schedule-link">
                                                    График
                                                </span>
                                                <div class="work-schedule-tooltip">
                                                    <table class="work-schedule-table">
                                                        {% for schedule in schedules %}
                                                            <tr class="{% if schedule.day == today_weekday %}current-day{% endif %}">
                                                                <td class="work-schedule-day">
                                                                    {{ schedule.get_day_display }}
                                                                </td>
                                                                <td class="work-schedule-time">
                                                                    {% if schedule.is_closed %}
                                                                        не работает
                                                                    {% else %}
                                                                        с {{ schedule.open_time|time:"H:i" }} до {{ schedule.close_time|time:"H:i" }}
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                        {% endfor %}
                                                    </table>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Описание заведения -->
                    {% if place_features or place.description %}
                        <div id="place-description" class="place-description-section">
                            <div class="place-description-inner">
                                <h3>О {{ place_type_phrase }}</h3>

                                <!-- Проверка наличия особенностей -->
                                {% if place_features %}
                                    <!-- Особенности заведения -->
                                    <div class="features-container">
                                        <ul class="features-list">
                                            {% for place_feature in place_features %}
                                                <li class="feature-element {% if place_feature.description %}has-description{% endif %}">
                                                    {{ place_feature.feature.name }}
                                                    {% if place_feature.description %}
                                                        <div class="tooltip">
                                                            {{ place_feature.description|safe }}
                                                        </div>
                                                    {% endif %}
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endif %}

                                <!-- Проверка наличия описания -->
                                <div class="description-container">
                                    {% if place.description %}
                                        <div class="place-description-text">{{ place.description|safe }}</div>
                                    {% else %}
                                        <div class="place-description-text">Описание заведения отсутствует.</div> <!-- Временная заглушка -->
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    <div id="menu-prices" class="menu-prices-section mt-3 mb-3">
                        <!-- Content about the menu and prices -->
                        <div class="place-menu-section">
                            <div class="place-menu-inner">
                                <h2>Меню</h2>
            
                                <!-- Блоки для меню -->
                                <div class="place-menu-category">
                                    <h3>Закуски</h3>
                                    <ul class="menu-items">
                                        {% for item in place.menu.snacks %}
                                        <li class="menu-item">
                                            <span class="menu-item-name">{{ item.name }}</span>
                                            <span class="menu-item-price">{{ item.price }} руб.</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
            
                                <div class="place-menu-category">
                                    <h3>Основные блюда</h3>
                                    <ul class="menu-items">
                                        {% for item in place.menu.main_courses %}
                                        <li class="menu-item">
                                            <span class="menu-item-name">{{ item.name }}</span>
                                            <span class="menu-item-price">{{ item.price }} руб.</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
            
                                <div class="place-menu-category">
                                    <h3>Напитки</h3>
                                    <ul class="menu-items">
                                        {% for item in place.menu.drinks %}
                                        <li class="menu-item">
                                            <span class="menu-item-name">{{ item.name }}</span>
                                            <span class="menu-item-price">{{ item.price }} руб.</span>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                <!-- Add more categories as needed -->
                            </div>
                        </div>
                    </div>    
                    
                    {% include 'reservations/halls_and_tables.html' %}
            
                    {% include 'reservations/reviews_section.html' %}
                </div>
                <aside class="place-detail-aside">
                    <div class="place-detail-booking">
                        <div class="booking-popup">
                            <form method="post" class="booking-popup-form"
                                action="{% url 'reserve_table' city_slug=selected_city.slug place_slug=place.slug %}">
                                {% csrf_token %}
                                <div class="booking-popup-wrapper">
                                    <div class="booking-popup-wrapper-container">
                                        <h3>Заказ столика</h3>
                                        <div class="form-row">
                                            <div class="form-col">
                                                {{ reservation_form.date.label_tag }}
                                                {{ reservation_form.date }}
                                            </div>
                                            <div class="form-col">
                                                {{ reservation_form.time.label_tag }}
                                                {{ reservation_form.time }}
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-col">
                                                {{ reservation_form.customer_phone.label_tag }}
                                                {{ reservation_form.customer_phone }}
                                            </div>
                                            <div class="form-col">
                                                {{ reservation_form.guests.label_tag }}
                                                {{ reservation_form.guests }}
                                            </div>
                                        </div>
                                        {{ reservation_form.customer_name.label_tag }}
                                        {{ reservation_form.customer_name }}
                                        {{ reservation_form.customer_email.label_tag }}
                                        {{ reservation_form.customer_email }}
                                        {% if reservation_form.customer_email.help_text %}
                                            <small class="form-text text-muted">{{ reservation_form.customer_email.help_text }}</small>
                                        {% endif %}
                                        {{ reservation_form.wishes.label_tag }}
                                        {{ reservation_form.wishes }}
                                        {% if reservation_form.errors %}
                                            <div class="form-errors">
                                                {% for field in reservation_form %}
                                                    {% for error in field.errors %}
                                                        <div class="error-message">{{ error }}</div>
                                                    {% endfor %}
                                                {% endfor %}
                                                {% for error in reservation_form.non_field_errors %}
                                                    <div class="error-message">{{ error }}</div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                        <button type="submit">
                                            Забронировать
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </aside>
                <!-- Модальное окно -->
                <div id="reservationModal" class="reservation-modal" style="display: {% if reservation_successful %} block {% else %} none {% endif %};">
                    <div class="reservation-modal-content">
                        <span class="reservation-modal-close">&times;</span>
                        {% if reservation_data %}
                            <div class="reservation-modal-header">Здравствуйте, {{ reservation_data.name }}!</div>
                            <div class="reservation-modal-body">
                                <p>Мы получили ваш резерв на</p>
                                <p><strong>{{ reservation_message }}</strong></p>
                                <p>Ожидайте подтверждение по СМС на номер <strong>{{ reservation_data.phone }}</strong>.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            <div id="similar-places" class="similar-places-section mt-3 mb-3">
                <h2>Похожие заведения</h2>
                <div class="similar-places-container">
                    <!-- Проверяем, есть ли похожие заведения -->
                    {% if similar_places %}
                        {% for similar_place in similar_places %}
                            <div class="similar-place-item">
                                {% if similar_place.get_cover_image %}
                                    <img src="{{ similar_place.get_cover_image }}" alt="Image of {{ similar_place.name }}" class="similar-place-image"/>
                                {% else %}
                                    <div class="no-image-placeholder">
                                        <svg xmlns="http://www.w3.org/2000/svg" height="96px" viewBox="0 -960 960 960" width="96px" fill="#888" class="no-images-icon">
                                            <path d="M479.5-267q72.5 0 121.5-49t49-121.5q0-72.5-49-121T479.5-607q-72.5 0-121 48.5t-48.5 121q0 72.5 48.5 121.5t121 49Zm0-60q-47.5 0-78.5-31.5t-31-79q0-47.5 31-78.5t78.5-31q47.5 0 79 31t31.5 78.5q0 47.5-31.5 79t-79 31.5ZM140-120q-24 0-42-18t-18-42v-513q0-23 18-41.5t42-18.5h147l73-87h240l73 87h147q23 0 41.5 18.5T880-693v513q0 24-18.5 42T820-120H140Zm0-60h680v-513H645l-73-87H388l-73 87H140v513Zm340-257Z"/>
                                        </svg>
                                        <p class="no-images-message" style="width:280px">Скоро здесь будет фото – интерьер уже позирует</p>
                                    </div>
                                {% endif %}
                                <div class="similar-place-info">
                                    <div class="similar-place-name">{{ similar_place.name }}</div>
                                    <div class="similar-place-type">{{ similar_place.type }}</div>
                                    <a href="{% url 'place_detail' city_slug=similar_place.city.slug place_slug=similar_place.slug %}" class="similar-place-link">Подробнее</a>
                                </div>
                            </div>
                        {% empty %}
                        <p>Похожие заведения не найдены.</p>
                        {% endfor %}
                    {% else %}
                        <p>Похожие заведения не найдены.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const dateInput = document.getElementById("id_date");
        const timeSelect = document.getElementById("id_time");
        
        // Установка текущей даты при загрузке страницы
        const today = new Date().toISOString().split("T")[0];
        dateInput.value = today;

        // Загрузка доступных временных слотов для текущей даты
        updateAvailableTimeSlots(today);

        // Обновление временных слотов при изменении даты
        dateInput.addEventListener("change", function () {
            const selectedDate = dateInput.value;
            updateAvailableTimeSlots(selectedDate);
        });

        function updateAvailableTimeSlots(date) {
            const placeId = "{{ place.id }}";  // ID заведения

            // Добавляем индикатор загрузки или блокируем выбор времени
            timeSelect.disabled = true;
            timeSelect.innerHTML = '<option>Загрузка...</option>';

            // Выполняем запрос на сервер для получения временных слотов
            fetch(`/place/${placeId}/available-time-slots/?date=${date}`)
                .then(response => response.json())
                .then(data => {
                    // Очистка текущих опций времени
                    timeSelect.innerHTML = '';
                    
                    if (data.length > 0) {
                        // Добавляем доступные временные слоты
                        data.forEach(timeSlot => {
                            const option = document.createElement("option");
                            option.value = timeSlot;
                            option.text = timeSlot;
                            timeSelect.appendChild(option);
                        });
                        timeSelect.disabled = false;  // Разблокируем выбор времени
                    } else {
                        // Сообщение, если слоты недоступны
                        const option = document.createElement("option");
                        option.value = '';
                        option.text = 'Закрыто';
                        timeSelect.appendChild(option);
                        timeSelect.disabled = true;  // Блокируем выбор
                    }
                })
                .catch(error => {
                    console.error('Ошибка при получении временных слотов:', error);
                    // В случае ошибки показываем сообщение
                    timeSelect.innerHTML = '<option>Ошибка загрузки</option>';
                    timeSelect.disabled = true;  // Блокируем выбор
                });
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const favoriteButtons = document.querySelectorAll(".favorite-button");
        const isAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};
        
        favoriteButtons.forEach((button) => {
            button.addEventListener("click", function (event) {
                if (!isAuthenticated) {
                    // If user is not authenticated, show the login modal
                    event.preventDefault();
                    document.getElementById('loginModal').style.display = 'block';
                    return;
                }

                const placeId = this.getAttribute("data-place-id");
                const url = "{% url 'users:toggle_favorite' 0 %}".replace("/0/", `/${placeId}/`);

                fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": getCookie("csrftoken"),
                    },
                })
                .then((response) => response.json())
                .then((data) => {
                    if (data.status === "added") {
                        this.classList.add("favorited");
                    } else if (data.status === "removed") {
                        this.classList.remove("favorited");
                    }
                });
            });
        });

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                const cookies = document.cookie.split(";");
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === name + "=") {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const sliderWrapper = document.querySelector('.place-slider-wrapper');
        const slides = document.querySelectorAll('.place-slider-item');
        const prevButton = document.querySelector('.gallery-prev-slide');
        const nextButton = document.querySelector('.gallery-next-slide');
        let currentIndex = 0;
    
        function updateButtons() {
            prevButton.classList.toggle('hidden', currentIndex === 0);
            nextButton.classList.toggle('hidden', currentIndex >= slides.length - 1);
        }
    
        function showSlide(index) {
            const slideWidth = slides[0].clientWidth + 5; // ширина слайда плюс расстояние
            const maxShift = sliderWrapper.scrollWidth - sliderWrapper.clientWidth;
            const newTransform = Math.min(index * slideWidth, maxShift);
            
            sliderWrapper.style.transform = `translateX(-${newTransform}px)`;
    
            currentIndex = index;
            updateButtons();
        }
    
        prevButton.addEventListener('click', function() {
            if (currentIndex > 0) {
                showSlide(currentIndex - 1);
            }
        });
    
        nextButton.addEventListener('click', function() {
            if (currentIndex < slides.length - 1) {
                showSlide(currentIndex + 1);
            }
        });
    
        showSlide(currentIndex);
    
        // Ленивая загрузка изображений
        const lazyImages = document.querySelectorAll('img.lazy');
    
        if ("IntersectionObserver" in window) {
            const lazyImageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const lazyImage = entry.target;
                        lazyImage.src = lazyImage.dataset.src;
                        lazyImage.classList.remove('lazy');
                        lazyImageObserver.unobserve(lazyImage);
                    }
                });
            });
    
            lazyImages.forEach(image => {
                lazyImageObserver.observe(image);
            });
        } else {
            // Для браузеров, не поддерживающих IntersectionObserver
            lazyImages.forEach(image => {
                image.src = image.dataset.src;
                image.classList.remove('lazy');
            });
        }
    
        // Модальное окно
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("modalImage");
        const closeBtn = document.querySelector(".gallery-modal-close");
        const modalPrev = document.querySelector(".gallery-modal-prev");
        const modalNext = document.querySelector(".gallery-modal-next");
    
        function showModalImage(index) {
            modalImg.src = slides[index].querySelector('img').src;
            modalImg.dataset.index = index;
        }
    
        slides.forEach((slide, index) => {
            slide.addEventListener('click', function() {
                modal.style.display = "flex";
                showModalImage(index);
            });
        });
    
        closeBtn.onclick = function() {
            modal.style.display = "none";
        }
    
        window.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        }
    
        modalPrev.onclick = function() {
            let index = parseInt(modalImg.dataset.index, 10);
            if (index > 0) {
                showModalImage(index - 1);
            }
        }
    
        modalNext.onclick = function() {
            let index = parseInt(modalImg.dataset.index, 10);
            if (index < slides.length - 1) {
                showModalImage(index + 1);
            }
        }
    
        // Обновление слайдера при изменении размера окна
        window.addEventListener('resize', function() {
            showSlide(currentIndex);
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const modal = document.getElementById('reservationModal');
        const closeModal = document.querySelector('.reservation-modal-close');
        
        if (closeModal) {
            closeModal.addEventListener('click', function() {
                modal.style.display = 'none';
            });
        }
        
        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const workScheduleLink = document.querySelector('.work-schedule-link');
        const tooltip = document.querySelector('.work-schedule-tooltip');
    
        workScheduleLink.addEventListener('click', function(event) {
            event.preventDefault(); // предотвращаем добавление # в URL и перемещение страницы
            tooltip.style.display = tooltip.style.display === 'block' ? 'none' : 'block';
        });
    
        document.addEventListener('click', function(event) {
            if (!workScheduleLink.contains(event.target) && !tooltip.contains(event.target)) {
                tooltip.style.display = 'none';
            }
        });
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var accordions = document.querySelectorAll(".accordion-button");
    
        accordions.forEach(function(button, index) {
            var content = button.nextElementSibling;
    
            // Открываем первый таб при загрузке страницы
            if (index === 0) {
                content.style.maxHeight = content.scrollHeight + "px";
            }
    
            button.addEventListener("click", function() {
                // Переключение состояния текущего аккордеона
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });
        });
    });
</script>
{% endblock %}